{% extends 'base.html' %}
{% block loader %}

<div id="loader" ></div>
<div id="fader"></div> 
<h1 id="generate">Generating, please wait...</h1>
<a href="{{url_for('static',filename='cover_letter.txt') }}" id="downloadLink" download="cover_letter.txt">Click me to download</a>
<div id="dialog" title="Dialog Title">I'm in a dialog</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript"> 
    var download_url = "{{url_for('static',filename='cover_letter.txt') }}";

  $(document).ready(function() {
    document.getElementById("loader").style.display = "block";
    document.getElementById("fader").style.display = "block";
    var callCount = 0;
    function checkStatus() {
      $.ajax({
        url: download_url,
        type: 'HEAD',
        statusCode: {
          404: function() {
            // alert('page not found');
            // after a certain period of time of no response from backend, needs to take user back to index
            callCount++;
            if (callCount>5) {
              // alert('Oops, something happened, please try again!');
              $("#dialog").dialog();
              window.location.href = "{{url_for('index') }}";
            }
            
          },
          200: function() {
            // window.location.href = download_url;
            document.getElementById("loader").style.display = "none";
            document.getElementById("fader").style.display = "none";
            document.getElementById("generate").style.display = "none";
            document.getElementById("downloadLink").style.display = "block";

          }
        }
      });
    };
    // Interval to check the status every 5 seconds
    setInterval(checkStatus, 1000);
  });



</script>
{% endblock %}