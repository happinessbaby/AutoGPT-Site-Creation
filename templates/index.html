{% extends 'base.html' %}

{% block content %}
    <h1>{% block title %} Cover Letter Generator {% endblock %}</h1>

    <form method="POST"  action="/loading"  enctype="multipart/form-data" id = "myform" onsubmit="return loadFile();" >
        {{ form.csrf_token }}
        <p>
            {{ form.company.label }}
            {{ form.company(size=20) }}
        </p>

        {% if form.company.errors %}
            <ul class="errors">
                {% for error in form.name.errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        {% endif %}

        <p>
            {{ form.job.label }}
            {{ form.job() }}
        </p>

        {% if form.job.errors %}
            <ul class="errors">
                {% for error in form.company.errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        {% endif %}

        <p>
            {{ form.hidden_tag() }}
            {{ form.file }}
        </p>

        {% if form.file.errors %}
            <ul class="errors">
                {% for error in form.file.errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        {% endif %}

        <p>
            {{ form.submit()  }}
        </p>
    </form>

    <script type="text/javascript">
        function loadFile(){
          // $("#loader").show();
          // $("#fader").show();
        //   document.getElementById("loader").style.display = "block";
        //   document.getElementById("fader").style.display = "block";
           // Start the file download by setting the href of the download link (replace 'fileUrl' with your actual file URL)
          // document.getElementById("downloadLink").href = "{{url_for('static',filename='cover_letter.txt') }}";
          // // // Display the download link and start checking if the file has finished downloading
          // document.getElementById("downloadLink").style.display = "block";
          // checkFileDownloaded();   
          let form = document.getElementById("myform");
            let csrf_token = document.getElementById("csrf_token").value
                formData.append("csrf_token", csrf_token)
                fetch("{{ url_for('index') }}", {
                    method: "post",
                    body: formData
             })
                 .then(response => response.json())
                 .then(response => {
                     console.log(response["data"]);
                 });
        }

        // document.getElementById("submit").addEventListener("click", function () {
        //     var loader = document.getElementById("loader");
        //     var fader = document.getElementById("fader");
        //     loader.style.display = "block";
        //     fader.style.display = "block";
        //     let form = document.getElementById("myform");
        //     let csrf_token = document.getElementById("csrf_token").value
        //         formData.append("csrf_token", csrf_token)
        //         fetch("{{ url_for('index') }}", {
        //             method: "post",
        //             body: formData
        //      })
        //          .then(response => response.json())
        //          .then(response => {
        //              console.log(response["data"]);
        //          });
        // });
    </script>

    <ul>
        {% for file in files %}
         <li> <a href="{{ url_for('download', filename=file) }}">{{ file }}</a></li>
        {% endfor %}
    </ul>



{% endblock %}